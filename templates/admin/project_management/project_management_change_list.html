{% extends "admin/base_site.html" %}
{% load i18n admin_urls static admin_list %}

{% block extrastyle %}
  {{ block.super }}
  <link rel="stylesheet" type="text/css" href="{% static "admin/css/changelists.css" %}">
  <style>
    /* Container styles */
    #content-main {
      width: 100%;
      box-sizing: border-box;
      padding: 20px;
    }

    /* Horizontal Filter Styles */
    .horizontal-filters {
      background: #f8f9fa;
      padding: 15px 20px;
      margin-bottom: 20px;
      border-radius: 4px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      width: 100%;
      box-sizing: border-box;
    }

    .filter-row {
      display: flex;
      align-items: center;
      gap: 20px;
      flex-wrap: nowrap;
      justify-content: flex-start;
      width: 100%;
    }

    .filter-item {
      display: flex;
      align-items: center;
      gap: 10px;
      flex: 1;
    }

    .filter-label {
      font-weight: bold;
      min-width: 100px;
      white-space: nowrap;
    }

    select.filter-select {
      padding: 6px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      width: 100%;
      max-width: 200px;
    }

    input.datepicker {
      padding: 6px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      width: 100%;
      max-width: 200px;
    }

    .filter-buttons {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-left: auto;
    }

    .filter-button {
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
      white-space: nowrap;
    }

    .apply-filter {
      background-color: #447e9b;
      color: white;
    }

    .clear-filter {
      background-color: #6c757d;
      color: white;
    }

    .filter-button:hover {
      opacity: 0.9;
    }

    /* Hide default filter */
    #changelist-filter {
      display: none;
    }

    /* Table styles */
    #changelist {
      width: 100%;
    }

    .results {
      width: 100%;
    }

    #result_list {
      width: 100%;
    }

    .change-list .filtered .results {
      width: 100% !important;
      margin-right: 0 !important;
    }

    /* Search form styles */
    #changelist-search {
      width: 100%;
      margin-bottom: 15px;
    }

    #changelist-search label {
      display: none;
    }

    #changelist-search input[type="text"] {
      padding: 8px;
      width: 250px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }

    #changelist-search input[type="submit"] {
      padding: 8px 16px;
      background: #417690;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
  </style>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
{% endblock %}

{% block content %}
  <div id="content-main">
    {% block object-tools %}
      <ul class="object-tools">
        {% block object-tools-items %}
          {% if has_add_permission %}
            <li>
              <a href="{% url cl.opts|admin_urlname:'add' %}" class="addlink">
                {% blocktranslate with cl.opts.verbose_name as name %}Add {{ name }}{% endblocktranslate %}
              </a>
            </li>
          {% endif %}
        {% endblock %}
      </ul>
    {% endblock %}

    <!-- Horizontal Filters -->
    <div class="horizontal-filters">
      <form id="changelist-filter-form" method="GET">
        <div class="filter-row">
          <div class="filter-item">
            <label class="filter-label">Status:</label>
            <select name="status" class="filter-select">
              <option value="">All</option>
              <option value="active" {% if request.GET.status == 'active' %}selected{% endif %}>Active</option>
              <option value="inactive" {% if request.GET.status == 'inactive' %}selected{% endif %}>Inactive</option>
            </select>
          </div>
          <div class="filter-item">
            <label class="filter-label">Modified Date:</label>
            <input type="text" name="modified_date" class="datepicker" placeholder="Select date"
                   value="{{ request.GET.modified_date|default:'' }}" autocomplete="off">
          </div>
          <div class="filter-buttons">
            <button type="submit" class="filter-button apply-filter">Apply Filters</button>
            <button type="button" class="filter-button clear-filter" onclick="clearFilters()">Clear Filters</button>
          </div>
        </div>
      </form>
    </div>

    <!-- Results -->
    {% if cl.search_fields %}
      {% block search %}{% search_form cl %}{% endblock %}
    {% endif %}

    <div id="changelist" class="module filtered">
      {% block date_hierarchy %}{% if cl.date_hierarchy %}{% date_hierarchy cl %}{% endif %}{% endblock %}

      <form id="changelist-form" method="post"{% if cl.formset and cl.formset.is_multipart %} enctype="multipart/form-data"{% endif %} novalidate>{% csrf_token %}
        {% if cl.formset %}
          <div>{{ cl.formset.management_form }}</div>
        {% endif %}

        {% block result_list %}
          {% if action_form and actions_on_top and cl.show_admin_actions %}{% admin_actions %}{% endif %}
          {% result_list cl %}
          {% if action_form and actions_on_bottom and cl.show_admin_actions %}{% admin_actions %}{% endif %}
        {% endblock %}
      </form>
    </div>
  </div>
{% endblock %}

{% block extrajs %}
  {{ block.super }}
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize date picker
      flatpickr(".datepicker", {
        dateFormat: "Y-m-d",
        allowInput: true,
        wrap: true,
        defaultDate: "{{ request.GET.modified_date|default:'' }}"
      });

      // Set current date-time in a human-readable format
      const currentDate = new Date();
      const formattedDate = currentDate.toISOString().slice(0, 19).replace('T', ' ');
      console.log('Current UTC Time:', formattedDate);
    });

    // Clear filters function
    function clearFilters() {
      const form = document.getElementById('changelist-filter-form');
      form.querySelector('select[name="status"]').value = '';
      form.querySelector('input[name="modified_date"]').value = '';
      form.submit();
    }
  </script>
{% endblock %}